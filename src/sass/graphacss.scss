/* ==========================================================================
   Graphacss data
   ========================================================================== */

// Values for your chart
$values: (title1: 24, title2: 32, title3: 12, nouvelcol: 56);

// Color for the bars (repeat automatically)
$barColors: ($blue, $red, $navy);

/* ==========================================================================
   Graphacss parameters
   ========================================================================== */

// Units used for the elements (char, legend, bars, etc.)
$units: 'px'; // <$units> : [px | cm | mm | % | ch | pc | in | em | rem | pt | ex | vw | vh]
// Units used for the fonts
$unitsFont: 'px';

// Default font families
$defaultFont: 'Helvetica', sans-serif;

// Colors
$graphicBackground: #EEE; // Background of the chart
$barColor: $blue; // Color of the bars
$valueColor: #FFF; // Text color for the bar's value
$labelColor: $black; // Text color for the bar's label

// Chart sizes
$graphicWidth: 800; // Width of the chart
$graphicHeight: 500; // Height of the chart
$barWidth: 50; // Width of the bars
$barMargin: 15; // Margin between the bars
$valueMin: 0; // Minimum value of the chart
$valueMax: 120; // Maximum value of the chart
$legendGap: 10; // Gap between the values in the legend
$legendPosition: 'left'; // <$legendPosition> : [left | right] - Display the legend on the left or right

// Group bars
$groupBars: 3; // TODO Group the bars (useful for comparator)
$groupMargin: 30;

// Bar values displayed
$displayValues: true; // <$displayValues> : [bool] - Display values for the bars
$valuePrefix: '';
$valueSuffix: '%';
$valuePosition: 'inside'; // <$valuePosition> : [inside | outside]
$valueFontFamily: $defaultFont;
$valueFontSize: 18;
$valueLineHeight: 20;
$valueMarginBar: 5;
$valueLines: 1;
$valueHeight: $valueLineHeight*$valueLines+$valueMarginBar;

// Bar labels
$displayLabels: true; // <$displayLabels> : [bool]
$labelPosition: 'bottom'; // <$labelPosition> : [top | bottom]
$labelFontFamily: $defaultFont;
$labelFontSize: 12;
$labelLineHeight: 16;
$labelMaxLines: 3;
$labelHeight: $labelLineHeight*$labelMaxLines;

/* ==========================================================================
   Graphacss framework
   ========================================================================== */

//@warn type-of(decimal-ceil($valueMax/$legendStep, 0));
$numberStep: decimal-ceil($valueMax/$legendGap, 0);
//@warn("Steps : #{$numberStep}");
$spaceStep: decimal-ceil($graphicHeight/$numberStep, 0);
//@warn("Space between steps : #{$spaceStep}");
$pixelByPoint: decimal-ceil($graphicHeight/$valueMax, 0);
//@warn("Pixels by point : #{$pixelByPoint}");

.graphacss {
    position: relative;
    display: block;
    background-color: $graphicBackground;
    width: to-length($graphicWidth, $units);
    height: to-length($graphicHeight, $units);

    &__steps {
        &_step {
            position: absolute;
            display: block;
            @if($legendPosition == 'left') {
                left: 0;
            } @else {
                right: 0;
            }
            bottom: 0;

            &:nth-child(0) {
                content: "#{$valueMin}";
            }

            @for $i from 0 through $numberStep {
                &:nth-child(#{$i}) {
                    bottom: to-length($i*$spaceStep, $units);
                    border-bottom: 1px solid $black;

                    &:before {
                        content: "#{$i*$legendGap}";
                    }
                }
            }
        }
    }

    &__bars {
        &_bar {
            position: absolute;
            display: block;
            bottom: 0;
            width: to-length($barWidth, $units);
            @if(length($barColors) == 0) {
                background-color: $barColor;
            }

            // Bars
            $nbBar: 1;
            @each $label, $value in $values {
                &:nth-child(#{$nbBar}){
                    left: to-length($nbBar*($barWidth+$barMargin), $units);
                    height: to-length($value*$pixelByPoint, $units);

                    @if(length($barColors) > 0) {
                        $listIndex: (1-$nbBar)%length($barColors);
                        background-color: nth($barColors, $listIndex+1);
                    }

                    @if($displayValues) {
                        // Value
                        &:before {
                            content: "#{$valuePrefix+$value+$valueSuffix}";
                            position: absolute;

                            @if ($valuePosition == 'outside'){
                                top: to-length(-$valueHeight, $unitsFont);
                                height: to-length($valueHeight, $unitsFont);
                                left: to-length(-$barMargin/2, $units);
                                width: to-length($barWidth+$barMargin, $units);
                            } @else {
                                height: auto;
                                top: to-length($valueMarginBar, $units);
                                width: to-length($barWidth, $units);
                            }

                            color: $valueColor;
                            font-family: $valueFontFamily;
                            font-size: to-length($valueFontSize, $unitsFont);
                            line-height: to-length($valueLineHeight, $unitsFont);
                            word-break: break-all;
                            text-align: center;
                        }
                    }

                    @if($displayLabels) {
                        // Label
                        &:after {
                            content: "#{$label}";
                            position: absolute;
                            bottom: to-length(-$labelHeight, $unitsFont);
                            height: to-length($labelHeight, $unitsFont);
                            left: to-length(-$barMargin/2, $units);
                            width: to-length($barWidth+$barMargin, $units);

                            color: $labelColor;
                            font-family: $labelFontFamily;
                            font-size: to-length($labelFontSize, $unitsFont);
                            line-height: to-length($labelLineHeight, $unitsFont);
                            word-break: break-all;
                            text-align: center;
                        }
                    }
                }
                $nbBar: $nbBar+1;
            }
        }
    }
}
